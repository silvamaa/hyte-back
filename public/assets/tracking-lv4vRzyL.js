import"./style-S5nVlci7.js";const y=document.querySelector(".logout a");y.addEventListener("click",()=>{localStorage.removeItem("token"),window.location.href="index.html"});document.getElementById("moodForm").addEventListener("submit",async e=>{e.preventDefault();const t=new FormData(e.target),n=t.get("mood"),o=t.get("sleep_hours"),r=t.get("notes");console.log("Form Data:",n,o,r);const a=localStorage.getItem("token");if(!a){alert("User information not found. Please log in again.");return}const s={mood:n,sleep_hours:o,notes:r};console.log("Request Body:",s);const l="/api/entries",c={method:"POST",headers:{Authorization:"Bearer "+a,"Content-Type":"application/json"},body:JSON.stringify(s)};try{const d=await fetch(l,c),p=await d.text();if(console.log("Response text:",p),!d.ok)throw new Error(`HTTP error! status: ${d.status}`);alert("Entry added successfully!")}catch(d){console.error("Error:",d),alert("Failed to add data. Error details can be found in the console.")}});const m=document.querySelector(".get_entries");m.addEventListener("click",i);async function i(){try{const e=localStorage.getItem("token");if(!e)throw new Error("User token not found. Please log in.");const t=await fetch("/api/entries",{method:"GET",headers:{Authorization:"Bearer "+e}});if(!t.ok)throw new Error("Failed to fetch diary entries.");const n=await t.json();if(n.length===0){alert("There are no diary entries for the user. Please add entry.");return}const o=document.querySelector(".diary-entries");o.innerHTML="",n.forEach(r=>{const a=document.createElement("tr");a.innerHTML=`
          <td>${r.mood}</td>
          <td>${r.sleep_hours}</td>
          <td>${r.notes}</td>
          <td>
            <button class="update" data-id="${r.entry_id}">Update</button>
          </td>
          <td>
            <button class="del" data-id="${r.entry_id}">Delete</button>
          </td>
        `,a.querySelector(".update").addEventListener("click",()=>{u(r)}),a.querySelector(".del").addEventListener("click",E),o.appendChild(a)})}catch(e){console.error("Error:",e.message),alert("Failed to fetch diary entries. Please try again.")}}async function h(e,t){try{const n=localStorage.getItem("token");if(!n)throw new Error("User token not found. Please log in.");if(!(await fetch(`/api/entries/${e}`,{method:"PUT",headers:{Authorization:"Bearer "+n,"Content-Type":"application/json"},body:JSON.stringify(t)})).ok)throw new Error("Failed to update entry.");alert("Entry updated successfully!"),i()}catch(n){console.error("Error:",n.message),alert("Failed to update entry. Please try again.")}}function u(e){const t=document.getElementById("updateModal"),n=document.getElementById("moodInput"),o=document.getElementById("sleepHoursInput"),r=document.getElementById("notesInput"),a=document.getElementById("updateForm");n.value=e.mood,o.value=e.sleep_hours,r.value=e.notes;function s(c){c.preventDefault();const d={mood:n.value,sleep_hours:o.value,notes:r.value};h(e.entry_id,d),t.style.display="none",a.removeEventListener("submit",s)}a.addEventListener("submit",s),document.querySelector("#updateModal .close").addEventListener("click",()=>{t.style.display="none",a.removeEventListener("submit",s)}),t.style.display="block"}document.querySelectorAll(".update").forEach(e=>{e.addEventListener("click",async t=>{const n=t.target.dataset.id,o=await fetchEntryDetails(n);o&&u(o)})});async function E(e){const t=e.target.dataset.id;if(confirm(`Are you sure you want to delete entry ID: ${t} ?`))try{const o=localStorage.getItem("token");if(!o)throw new Error("User token not found. Please log in.");if(!(await fetch(`/api/entries/${t}`,{method:"DELETE",headers:{Authorization:"Bearer "+o}})).ok)throw new Error("Failed to delete entry.");alert("Entry deleted successfully!"),i()}catch(o){console.error("Error:",o.message),alert("Failed to delete entry. Please try again.")}}
